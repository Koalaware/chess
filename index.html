<!doctypehtml><html lang=en><meta charset=UTF-8><meta content="width=device-width,initial-scale=1"name=viewport><title>KOALA_CHESS // v3.0</title><script src=https://code.jquery.com/jquery-3.5.1.min.js></script><link href=https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css rel=stylesheet><script src=https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js></script><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&display=swap"rel=stylesheet><style>:root{--bg-core:#050505;--bg-glass:rgba(20, 20, 20, 0.6);--bg-panel:rgba(15, 15, 15, 0.95);--border:rgba(255, 255, 255, 0.1);--accent-primary:#00ff9d;--accent-secondary:#00e5ff;--accent-danger:#ff2a2a;--text-main:#e0e0e0;--text-dim:#666;--font-mono:'JetBrains Mono',monospace}*{box-sizing:border-box;outline:0;user-select:none}body{margin:0;padding:0;background-color:var(--bg-core);background-image:linear-gradient(rgba(0,255,157,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,255,157,.03) 1px,transparent 1px);background-size:40px 40px;height:100vh;display:flex;align-items:center;justify-content:center;color:var(--text-main);font-family:var(--font-mono);overflow:hidden}.cyber-window{width:1500px;height:950px;background:var(--bg-panel);border:1px solid var(--border);box-shadow:0 0 50px rgba(0,0,0,.8),0 0 20px rgba(0,255,157,.05);backdrop-filter:blur(20px);border-radius:4px;display:flex;flex-direction:column;position:relative}.top-bar{height:50px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 25px;background:rgba(0,0,0,.4);font-size:14px;letter-spacing:2px;text-transform:uppercase}.brand{font-weight:800;color:#fff}.brand span{color:var(--accent-primary);text-shadow:0 0 10px var(--accent-primary)}.main-grid{display:grid;grid-template-columns:300px 1fr 350px;height:calc(100% - 50px - 35px)}.panel-left,.panel-right{padding:25px;display:flex;flex-direction:column;gap:20px;background:rgba(0,0,0,.2)}.panel-left{border-right:1px solid var(--border)}.panel-right{border-left:1px solid var(--border)}.section-title{font-size:11px;color:var(--accent-secondary);margin-bottom:10px;text-transform:uppercase;letter-spacing:1px;opacity:.8;border-bottom:1px solid var(--border);padding-bottom:5px}.btn{background:rgba(255,255,255,.03);border:1px solid var(--border);color:#aaa;padding:14px;cursor:pointer;font-family:var(--font-mono);font-size:12px;text-transform:uppercase;transition:all .2s ease;text-align:center;display:flex;align-items:center;justify-content:center;gap:10px}.btn:hover{background:rgba(0,255,157,.1);border-color:var(--accent-primary);color:#fff;box-shadow:0 0 15px rgba(0,255,157,.1)}.btn:active{transform:translateY(1px)}.btn.danger:hover{background:rgba(255,42,42,.1);border-color:var(--accent-danger);color:#fff;box-shadow:0 0 15px rgba(255,42,42,.1)}.stage{display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}.spawn-deck{display:flex;gap:8px;padding:10px 20px;background:#0a0a0a;border:1px solid var(--border);border-radius:4px;margin-bottom:25px;box-shadow:0 10px 30px rgba(0,0,0,.5)}.spawn-piece{width:45px;height:45px;background-size:cover;cursor:grab;opacity:.7;transition:.2s;filter:grayscale(.5)}.spawn-piece:hover{opacity:1;filter:grayscale(0);transform:scale(1.1)}.spawn-piece:active{cursor:grabbing}.board-wrapper{position:relative;display:flex;gap:20px}#myBoard{width:600px;height:600px;border:2px solid #333;box-shadow:0 0 50px rgba(0,0,0,.8)}.white-1e1d7{background-color:#2a2a2a;color:#b58863}.black-3c85d{background-color:#111;color:#f0d9b5}.eval-gauge{width:12px;height:600px;background:#111;border:1px solid #333;position:relative;overflow:hidden}.eval-fill{width:100%;background:var(--text-main);position:absolute;bottom:0;left:0;transition:height .5s ease}#overlay{position:absolute;top:0;left:0;pointer-events:none;z-index:100}.data-card{background:#0a0a0a;border:1px solid #333;padding:20px;margin-bottom:20px}.engine-output{font-size:32px;font-weight:700;color:var(--accent-primary);margin-bottom:5px;text-shadow:0 0 10px rgba(0,255,157,.3)}.engine-pv{font-size:11px;color:#888;word-break:break-all;line-height:1.4}.control-group{margin-bottom:20px}.control-label{display:flex;justify-content:space-between;font-size:12px;color:#aaa;margin-bottom:8px}select.cyber-select{width:100%;background:#111;color:#fff;border:1px solid #333;padding:10px;font-family:var(--font-mono);cursor:pointer}select.cyber-select:focus{border-color:var(--accent-secondary)}input[type=range]{width:100%;-webkit-appearance:none;background:#222;height:4px}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:12px;height:12px;background:var(--accent-secondary);border-radius:0;cursor:pointer;box-shadow:0 0 10px var(--accent-secondary)}.footer{height:35px;background:#080808;border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 25px;font-size:11px;color:#555}.status-light{width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:8px;background:#333}.status-light.active{background:var(--accent-primary);box-shadow:0 0 10px var(--accent-primary)}.status-light.thinking{background:gold;box-shadow:0 0 10px gold}.dragging-helper{position:fixed;pointer-events:none;z-index:1000;width:50px;height:50px;background-size:cover;opacity:.8}.highlight-square{box-shadow:inset 0 0 10px 2px rgba(0,255,157,.4)!important;background-color:rgba(0,255,157,.15)!important}.highlight-origin{background-color:rgba(255,255,255,.05)!important;border:1px solid rgba(0,255,157,.3)}.piece-417db[style*="position: absolute"]{transition:top .1s ease-out,left .1s ease-out,transform .15s ease-out,filter .15s ease-out!important;filter:drop-shadow(0 15px 20px rgba(0, 0, 0, .5))!important;transform:scale(1.1) translateY(-5px)!important;z-index:2000!important}</style><div class=cyber-window><div class=top-bar><div class=brand>KOALA_ <span>CHESS</span> // CLI_V3</div><div style=font-size:11px;color:#555>SYSTEM: <span style=color:var(--accent-secondary)>ONLINE</span></div></div><div class=main-grid><div class=panel-left><div class=section-title>Manual Override</div><div class=btn onclick=flipBoard()>Flip Board</div><div class=btn onclick=customUndo()>Undo [Ctrl+Z]</div><div class=btn onclick=customRedo()>Redo [Ctrl+Y]</div><div class="btn danger"onclick=resetBoard()>System Reset</div><div class=section-title style=margin-top:20px>Instructions</div><div style=font-size:12px;color:#777;line-height:1.6>> 1. Use it.<br>> 2. Goodluck<br>> 3. Have fun<br>> 4. Use it for educational purposes only :3 u wouldn't use it for anything else right</div></div><div class=stage><div class=spawn-deck id=spawnDeck></div><div class=board-wrapper id=boardWrapper><div class=eval-gauge><div class=eval-fill id=evalFill style=height:50%></div></div><div style=position:relative><div id=myBoard></div><svg height=600 id=overlay preserveAspectRatio=none viewBox="0 0 100 100"width=600><defs><marker id=arrow-green markerHeight=4 markerWidth=4 orient=auto refX=2 refY=2><path d="M0,0 L4,2 L0,4 Z"fill=#00ff9d /></marker></defs></svg></div></div></div><div class=panel-right><div class=section-title>Telemetry</div><div class=data-card><div style=font-size:10px;color:#555;margin-bottom:5px>EVALUATION</div><div class=engine-output id=evalScore>0.00</div><div class=engine-pv id=pvLine>Waiting for input...</div></div><div class=section-title>Engine Configuration</div><div class=control-group><div class=control-label>CALCULATION TARGET</div><select class=cyber-select id=calcTarget onchange=forceEval()><option value=both>Global (White & Black)<option value=w>White Only<option value=b>Black Only<option value=none>Standby (Off)</select></div><div class=control-group><div class=control-label><span>SEARCH DEPTH</span> <span id=depthVal style=color:var(--accent-secondary)>18</span></div><input id=depthRange max=26 min=10 oninput='$("#depthVal").text(this.value)'type=range value=18></div><div class=btn onclick=forceEval() style=margin-top:auto;border-color:var(--accent-secondary);color:var(--accent-secondary)>Execute Analysis</div></div></div><div class=footer><div id=statusText>Ready</div><div><span id=engineStatus class=status-light></span> <span id=engineText>Stockfish 18 NNUE (WASM)</span></div></div></div><script>let board = null;
      let game = new Chess();
      let stockfish = null;
      let history = [game.fen()];
      let redoStack = [];
      let selectedSquare = null;
      const audioCtx = new(window.AudioContext || window.webkitAudioContext)();

      function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();ython -m http.server 8000
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        const now = audioCtx.currentTime;
        osc.frequency.setValueAtTime(type === 'move' ? 600 : 1200, now);
        osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
        gain.gain.setValueAtTime(0.05, now);
        osc.start(now);
        osc.stop(now + 0.1);
      }
      function removeHighlights() {
        $('#myBoard .square-55d63').removeClass('highlight-square highlight-origin');
      }

      function handleSquareSelect(square) {
        removeHighlights();
        const moves = game.moves({
          square: square,
          verbose: true
        });
        if (moves.length > 0 && selectedSquare !== square) {
          selectedSquare = square;
          $('#myBoard .square-' + square).addClass('highlight-origin');
          moves.forEach(m => $('#myBoard .square-' + m.to).addClass('highlight-square'));
        } else {
          selectedSquare = null;
        }
      }

      function clearOverlay() {
        const svg = document.getElementById('overlay');
        $(svg).find('line').remove();
      }

      function drawArrow(move) {
        if (!move || move === '(none)') return;
        clearOverlay();
        const from = move.substring(0, 2),
          to = move.substring(2, 4);
        const files = "abcdefgh",
          ranks = "87654321";
        const x1 = files.indexOf(from[0]),
          y1 = ranks.indexOf(from[1]);
        const x2 = files.indexOf(to[0]),
          y2 = ranks.indexOf(to[1]);
        const isFlipped = board.orientation() === 'black';
        const c = (v) => (isFlipped ? (7 - v) : v) * 12.5 + 6.25;
        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("x1", c(x1));
        line.setAttribute("y1", c(y1));
        line.setAttribute("x2", c(x2));
        line.setAttribute("y2", c(y2));
        line.setAttribute("stroke", "#00ff9d");
        line.setAttribute("stroke-width", "2");
        line.setAttribute("marker-end", "url(#arrow-green)");
        document.getElementById('overlay').appendChild(line);
      }
      function initStockfish() {
        const stockfishScript = "importScripts('https://cdnjs.cloudflare.com/ajax/libs/stockfish.js/10.0.0/stockfish.js');";
        const blob = new Blob([stockfishScript], {
          type: 'application/javascript'
        });
        const workerUrl = URL.createObjectURL(blob);
        stockfish = new Worker(workerUrl);
        stockfish.postMessage('uci');
        stockfish.onmessage = (e) => {
          const msg = e.data;
          if (msg.startsWith('bestmove')) {
            const best = msg.split(' ')[1];
            $('#engineStatus').removeClass('thinking').addClass('active');
            $('#engineText').text("Analysis Complete");
            drawArrow(best);
          } else if (msg.includes('score cp')) {
            const scoreMatch = msg.match(/score cp (-?\d+)/);
            if (scoreMatch) {
              const score = parseInt(scoreMatch[1]) / 100;
              $('#evalScore').text((score > 0 ? "+" : "") + score.toFixed(2));
              let h = 50 + (score * 10);
              $('#evalFill').css('height', Math.max(0, Math.min(100, h)) + '%');
            }
          } else if (msg.includes('mate')) {
            const mateMatch = msg.match(/score mate (-?\d+)/);
            if (mateMatch) {
              const mateIn = mateMatch[1];
              $('#evalScore').text("#" + mateIn);
              $('#evalFill').css('height', mateIn > 0 ? '100%' : '0%');
            }
          }
        };
        $('#engineText').text("Stockfish 10 (ASM.js)");
      }

      function forceEval() {
        if (!stockfish || $('#calcTarget').val() === 'none') return;
        $('#engineStatus').addClass('thinking');
        $('#engineText').text("Calculating...");
        stockfish.postMessage('stop');
        stockfish.postMessage('position fen ' + game.fen());
        stockfish.postMessage('go depth ' + $('#depthRange').val());
      }

      function flipBoard() {
        board.flip();
        clearOverlay();
        forceEval();
      }

      function resetBoard() {
        game.reset();
        board.start();
        history = [game.fen()];
        redoStack = [];
        clearOverlay();
        forceEval();
      }

      function customUndo() {
        if (history.length > 1) {
          redoStack.push(history.pop());
          game.load(history[history.length - 1]);
          board.position(game.fen());
          forceEval();
        }
      }

      function customRedo() {
        if (redoStack.length > 0) {
          const fen = redoStack.pop();
          history.push(fen);
          game.load(fen);
          board.position(game.fen());
          forceEval();
        }
      }

      function onDragStart(source, piece) {
        handleSquareSelect(source);
        $('.square-' + source + ' .piece-417db').css('opacity', '0');
        return !game.game_over();
      }

      function onDrop(source, target) {
        $('.piece-417db').css('opacity', '1');
        const move = game.move({
          from: source,
          to: target,
          promotion: 'q'
        });
        if (move === null) return 'snapback';
        playSound(move.captured ? 'capture' : 'move');
        history.push(game.fen());
        redoStack = [];
        board.position(game.fen());
        forceEval();
      }

      function initSpawnDeck() {
        const pieces = ['wP', 'wN', 'wB', 'wR', 'wQ', 'wK', 'bP', 'bN', 'bB', 'bR', 'bQ', 'bK'];
        const deck = $('#spawnDeck');
        deck.empty();
        pieces.forEach(p => {
          const img = `https://chessboardjs.com/img/chesspieces/wikipedia/${p}.png`;
          const el = $(`
											<div class="spawn-piece" draggable="true" style="background-image:url(${img})"></div>`);
          el.on('dragstart', (e) => e.originalEvent.dataTransfer.setData('text', p));
          deck.append(el);
        });
      }
$(document).ready(function() {

  board = Chessboard('myBoard', {
    draggable: true,
    position: 'start',
    onDragStart: onDragStart,
    onDrop: onDrop,
    onSnapEnd: () => board.position(game.fen()),
    pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
  });

  initSpawnDeck();

  fetch("/api/engine")
    .then(res => res.json())
    .then(data => {
      if (data.allowed) {
        initStockfish();
      } else {
        $('#engineText').text("Engine unavailable");
      }
    })
    .catch(() => {
      $('#engineText').text("Engine unavailable");
    });

});</script>
